{% extends "base.html" %}
{% block content %}
<h2>{{ place.name }}</h2>
{% if user.is_authenticated %}
    <form method="post" action="{% url 'places:place_like' place.pk %}">
        {% csrf_token %}
        {% if place.is_liked %}
            â¤ï¸ ì·¨ì†Œ
        {% else %}
            ğŸ¤ ì¢‹ì•„ìš”
        {% endif %}
    </form>
{% endif %}
<p>{{ place.address }} ({{ place.region }})</p>
<p>{{place.overview|default:"ê°œìš” ì—†ìŒ"}}</p>
<p>{{ place.summary|default:"ì„¤ëª… ì—†ìŒ" }}</p>
<ul>
    {% for tag in place.tags.all %}
    <li>#{{ tag.name }}</li>
    {% endfor %}
</ul>
<a href="{% url 'places:main' %}">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
<!-- ë¸”ë¡œê·¸ í›„ê¸° ì„¹ì…˜ -->
<section class="mt-6">
    <h3>ë¸”ë¡œê·¸ í›„ê¸°</h3>
    <button id="load-blog-reviews" data-place-id="{{ place.id }}">ë¸”ë¡œê·¸ í›„ê¸° ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <ul id="blog-review-list" style="margin-top:10px;"></ul>
</section>

<script>
(function(){
const btn = document.getElementById("load-blog-reviews");
const ul = document.getElementById("blog-review-list");
const clean = (s='') => s.replace(/<[^>]+>/g, '');

btn.addEventListener("click", async () => {
    ul.innerHTML = "<li>ë¡œë”© ì¤‘...</li>";
    try {
    const pid = btn.dataset.placeId;
    const res = await fetch(`/reviews/blogs/${pid}/`);
    const data = await res.json();
    ul.innerHTML = "";
    (data.items || []).forEach(it => {
        const li = document.createElement("li");
        li.innerHTML = `
        <a href="${it.link}" target="_blank" rel="noopener">${clean(it.title)}</a>
        <div>${clean(it.summary)}</div>
        <small>${it.blogger} Â· ${it.postdate}</small>
        `;
        ul.appendChild(li);
    });
    if ((data.items || []).length === 0) {
        ul.innerHTML = "<li>ê´€ë ¨ ë¸”ë¡œê·¸ í›„ê¸°ê°€ ì—†ì–´ìš”.</li>";
    }
    } catch (e) {
    console.error(e);
    ul.innerHTML = "<li>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.</li>";
    }
});
})();
</script>
{% endblock %}