{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/place_detail.css' %}">

<div class="place-detail container">
  <div class="place-detail__header">
    <h2 class="place-detail__title">{{ place.name }}</h2>
  </div>

  <!-- ì•¡ì…˜ ì¹´ë“œ: ì°œí•˜ê¸° + ì´ ì¥ì†Œê°€ í¬í•¨ëœ ë£¨íŠ¸ ë³´ê¸° -->
  <section class="card actions-card">
    <div class="actions-card__row">
      {% if user.is_authenticated %}
      <form method="post" action="{% url 'places:place_like' place.pk %}" class="like-form">
        {% csrf_token %}
        <button type="submit" class="like-button">
          {% if place.is_liked %}â¤ï¸ ì°œì·¨ì†Œ {% else %}ğŸ¤ ì°œí•˜ê¸°{% endif %}
        </button>
      </form>
      {% endif %}

      <a class="route-link btn btn-outline" href="{% url 'routes:place_routes' place.id %}">
        ì´ ì¥ì†Œê°€ í¬í•¨ëœ ë£¨íŠ¸ ë³´ê¸°
      </a>
    </div>
  </section>

  <div class="card">
    <div 
    id="map-{{ place.id }}"
    class="place-item__map"
    data-lat="{{place.lat}}"
    data-lng="{{place.lng}}"
    ></div>
  </div>

  <div class="card">
    <div class="meta-grid">
      <div class="meta-item meta-item-right">
        <div class="meta-label">ì£¼ì†Œ</div>
        <div class="meta-value">{{ place.address }}</div>
      </div>
      <div class="meta-item meta-item-right">
        <div class="meta-label">ì§€ì—­</div>
        <div class="meta-value">{{ place.region }}</div>
      </div>
      <div class="meta-item">
        <div class="meta-label">ë¶„ë¥˜</div>
        <div class="meta-value">
          {% if place.place_class == 1 %}ë ˆí¬ì¸ {% elif place.place_class == 2 %}ì‡¼í•‘{% elif place.place_class == 3 %}ê´€ê´‘ì§€{% elif place.place_class == 4 %}ë¬¸í™”ì‹œì„¤{% endif %}
        </div>
      </div>
    </div>
  </div>

  <section class="card">
    <h3 class="section-title">ê°œìš”</h3>
    <p class="section-text">{{ place.overview|default:"ê°œìš” ì—†ìŒ" }}</p>
  </section>

  <section class="card">
    <h3 class="section-title">ì„¤ëª…</h3>
    <p class="section-text">{{ place.summary|default:"ì„¤ëª… ì—†ìŒ" }}</p>
  </section>

  <section class="card">
    <h3 class="section-title">íƒœê·¸</h3>
    <ul class="tag-list">
      {% for tag in place.tags.all %}
      <li class="tag">#{{ tag.name }}</li>
      {% empty %}
      <li class="tag tag--empty">#íƒœê·¸ì—†ìŒ</li>
      {% endfor %}
    </ul>
  </section>

  <!-- ë¸”ë¡œê·¸ í›„ê¸° ì„¹ì…˜ -->
  <section class="card">
    <h3 class="section-title">ë¸”ë¡œê·¸ í›„ê¸°</h3>
    <button id="load-blog-reviews" data-place-id="{{ place.id }}" class="tag">ë¸”ë¡œê·¸ í›„ê¸° ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <ul id="blog-review-list" class="blog" style="margin-top:10px;"></ul>
  </section>

  <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
  <section class="card review-card">
    <h3 class="section-title">ëŒ“ê¸€</h3>

    <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
    {% if user.is_authenticated %}
    <div class="review-form-section">
      <h4 class="review-form__title">ëŒ“ê¸€ ì‘ì„±</h4>
      <form method="post" action="{% url 'reviews:place_create' place.id %}" class="review-form" id="review-form" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-grid">
          <div class="form-group">
            <label for="id_rating">í‰ì  *</label>
            <select name="rating" id="id_rating" class="form-control" required>
              <option value="">í‰ì  ì„ íƒ</option>
              <option value="5.0">5.0</option>
              <option value="4.5">4.5</option>
              <option value="4.0">4.0</option>
              <option value="3.5">3.5</option>
              <option value="3.0">3.0</option>
              <option value="2.5">2.5 </option>
              <option value="2.0">2.0</option>
              <option value="1.5">1.5</option>
              <option value="1.0">1.0</option>
              <option value="0.5">0.5</option>
              <option value="0.0">0.0</option>
            </select>
          </div>

          <div class="form-group form-group--full">
            <label for="id_content">ë‚´ìš© *</label>
            <textarea name="content" id="id_content" class="form-control" rows="4" required placeholder="ìƒì„¸í•œ í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"></textarea>
          </div>

          <div class="form-group form-group--full">
            <label for="id_photos">ì´ë¯¸ì§€ ì—…ë¡œë“œ (ìµœëŒ€ 5ì¥, ì„ íƒì‚¬í•­)</label>
            <input type="file" id="id_photos" name="photos" class="form-control" accept="image/*" multiple>
            <small class="form-text text-muted">JPG/PNG ë“± ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. ìµœëŒ€ 5ì¥ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</small>
            
            <!-- ìƒˆë¡œ ì—…ë¡œë“œí•˜ëŠ” íŒŒì¼ë“¤ì˜ ë¯¸ë¦¬ë³´ê¸° -->
            <div id="photo-previews" class="d-flex flex-wrap gap-2 mt-3"></div>
          </div>
        </div>
        <div class="review-form__actions">
          <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ì‘ì„±</button>
        </div>
      </form>
    </div>
    {% else %}
    <div class="review-form-section review-form-section--empty">
      <p>ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a href="{% url 'account_login' %}">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
    </div>
    {% endif %}

    <!-- ëŒ“ê¸€ ëª©ë¡ -->
    <div id="review-list" data-place-id="{{ place.id }}" class="review-list">
      <div class="loading-reviews">ëŒ“ê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      <!-- comment_crud.jsê°€ ì—¬ê¸°ì— ëª©ë¡ì„ ë Œë”ë§ -->
    </div>
  </section>

  <div class="place-detail__footer">
    <a class="back-link" href="{% url 'places:main' %}">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>
</div>

<script src="{% static 'js/map.js' %}?v={% now 'U' %}"></script>
<script
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwXkCM9qv8KRUi2rUVGSlMcRpKRix_Tvs&callback=initMap&v=weekly&libraries=marker"
defer
></script>
<script src="{% static 'js/like.js' %}"></script>
<script src="{% static 'js/comment_crud.js' %}"></script>
{% endblock %}
