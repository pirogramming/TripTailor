{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/place_detail.css' %}">

<div class="place-detail container">
  <div class="place-detail__header">
    <h2 class="place-detail__title">{{ place.name }}</h2>

    {% if user.is_authenticated %}
    <form method="post" action="{% url 'places:place_like' place.pk %}" class="like-form">
      {% csrf_token %}
      <button type="submit" class="like-button">
        {% if place.is_liked %}â¤ï¸ ì·¨ì†Œ{% else %}ğŸ¤ ì¢‹ì•„ìš”{% endif %}
      </button>
    </form>
    {% endif %}
  </div>

  <div class="card">
    <div class="map-section-detail"></div>
  </div>

  <div class="card">
    <div class="meta-grid">
      <div class="meta-item meta-item-right">
        <div class="meta-label">ì£¼ì†Œ</div>
        <div class="meta-value">{{ place.address }}</div>
      </div>
      <div class="meta-item meta-item-right">
        <div class="meta-label">ì§€ì—­</div>
        <div class="meta-value">{{ place.region }}</div>
      </div>
      <div class="meta-item">
        <div class="meta-label">ë¶„ë¥˜</div>
        <div class="meta-value">
          {% if place.place_class == 1 %}ë ˆí¬ì¸ {% elif place.place_class == 2 %}ì‡¼í•‘{% elif place.place_class == 3 %}ê´€ê´‘ì§€{% elif place.place_class == 4 %}ë¬¸í™”ì‹œì„¤{% endif %}
        </div>
      </div>
    </div>
  </div>

  <section class="card">
    <h3 class="section-title">ê°œìš”</h3>
    <p class="section-text">{{ place.overview|default:"ê°œìš” ì—†ìŒ" }}</p>
  </section>

  <section class="card">
    <h3 class="section-title">ì„¤ëª…</h3>
    <p class="section-text">{{ place.summary|default:"ì„¤ëª… ì—†ìŒ" }}</p>
  </section>

  <section class="card">
    <h3 class="section-title">íƒœê·¸</h3>
    <ul class="tag-list">
      {% for tag in place.tags.all %}
      <li class="tag">#{{ tag.name }}</li>
      {% empty %}
      <li class="tag tag--empty">#íƒœê·¸ì—†ìŒ</li>
      {% endfor %}
    </ul>
  </section>

  <!-- ë¸”ë¡œê·¸ í›„ê¸° ì„¹ì…˜ -->
  <section class="card">
      <h3 class="section-title">ë¸”ë¡œê·¸ í›„ê¸°</h3>
      <button id="load-blog-reviews" data-place-id="{{ place.id }}" class="tag">ë¸”ë¡œê·¸ í›„ê¸° ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <ul id="blog-review-list" style="margin-top:10px;">

      </ul>
  </section>

  <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
  <section class="card">
    <h3 class="section-title">ëŒ“ê¸€</h3>
    
    
    <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
    {% if user.is_authenticated %}
    <div class="review-form-section">
      <h4>ëŒ“ê¸€ ì‘ì„±</h4>
      <form method="post" action="{% url 'reviews:place_create' place.id %}" class="review-form" id="review-form">
        {% csrf_token %}
        <div class="form-group">
          <label for="id_title">ì œëª© *</label>
          <input type="text" name="title" id="id_title" class="form-control" required maxlength="200">
        </div>
        
        <div class="form-group">
          <label for="id_rating">í‰ì  *</label>
          <select name="rating" id="id_rating" class="form-control" required>
            <option value="">í‰ì  ì„ íƒ</option>
            <option value="5.0">5.0</option>
            <option value="4.5">4.5</option>
            <option value="4.0">4.0</option>
            <option value="3.5">3.5</option>
            <option value="3.0">3.0</option>
            <option value="2.5">2.5 </option>
            <option value="2.0">2.0</option>
            <option value="1.5">1.5</option>
            <option value="1.0">1.0</option>
            <option value="0.5">0.5</option>
            <option value="0.0">0.0</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="id_content">ë‚´ìš© *</label>
          <textarea name="content" id="id_content" class="form-control" rows="4" required placeholder="ìƒì„¸í•œ í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"></textarea>
        </div>

        <div class="form-group">
          <label>ì´ë¯¸ì§€ URL (ìµœëŒ€ 5ê°œ, ì„ íƒì‚¬í•­)</label>
          <div id="photo-inputs">
            <div class="photo-input-row">
              <input type="url" name="photo_urls[]" class="form-control photo-url-input" placeholder="https://example.com/image1.jpg">
              <div class="photo-preview"></div>
            </div>
          </div>
          <button type="button" id="add-photo-btn" class="btn btn-sm btn-outline-secondary">+ ì´ë¯¸ì§€ ì¶”ê°€</button>
          <small class="form-text text-muted">ëŒ“ê¸€ê³¼ í•¨ê»˜ í‘œì‹œí•  ì´ë¯¸ì§€ì˜ URLì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 5ê°œ)</small>
        </div>
        
        <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ì‘ì„±</button>
      </form>
    </div>
    {% else %}
    <div class="review-form-section">
      <p>ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a href="{% url 'account_login' %}">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
    </div>
    {% endif %}

    <!-- ëŒ“ê¸€ ëª©ë¡ -->
    <div id="review-list" data-place-id="{{ place.id }}">
      <!-- ëŒ“ê¸€ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
      <div class="loading-reviews">ëŒ“ê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
  </section>

  <div class="place-detail__footer">
    <a class="back-link" href="{% url 'places:main' %}">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    <br>
    <a class="route-link" href="{% url 'routes:place_routes' place.id %}">ì´ ì¥ì†Œê°€ í¬í•¨ëœ ë£¨íŠ¸ ë³´ê¸°</a>
  </div>
</div>

<script src="{% static 'js/like.js' %}"></script>
<script src="{% static 'js/comment_crud.js' %}"></script>

{% endblock %}
