{% load static %}
{% if likes_page %}
<link rel="stylesheet" href="{% static 'css/users/likes.css' %}?v={% now 'U' %}">
<div>
    <ul class="place-list">
        {% for like in likes_page %}
            
            <li class="place-item">
                {% with place=like.place %}
                <div 
                id="map-{{ place.id }}"
                class="place-item__map"
                data-lat="{{place.lat}}"
                data-lng="{{place.lng}}"
                ></div> <!-- ì§€ë„/ì´ë¯¸ì§€ ìë¦¬ -->
                <div class="place-item__head">
                <span class="place-item__name">{{ place.name }}</span>
                <span class="place-item__meta">({{ place.region }}) Â·
                    {% if place.place_class == 1 %}ë ˆí¬ì¸ {% elif place.place_class == 2 %}ì‡¼í•‘{% elif place.place_class == 3 %}ê´€ê´‘ì§€{% elif place.place_class == 4 %}ë¬¸í™”ì‹œì„¤{% endif %}
                </span>
                <a class="place-item__link" href="{% url 'places:place_detail' place.pk %}">ìì„¸íˆ ë³´ê¸°</a>

                {% if user.is_authenticated %}
                <form method="post" action="{% url 'places:place_like' place.pk %}" class="like-form">
                    {% csrf_token %}
                    <button type="submit" class="like-button">
                    {% if place.is_liked %}â¤ï¸ ì°œì·¨ì†Œ{% else %}ğŸ¤ ì°œí•˜ê¸°{% endif %}
                    </button>
                </form>

                <button type="button" class="add-to-route-btn" data-place-id="{{ place.id }}">â• ë£¨íŠ¸ì— ì¶”ê°€</button>
                <div class="route-dropdown" style="display:none; position:absolute; background:#fff; border:1px solid #ccc; padding:.5rem; z-index:10; min-width:200px;">
                    <div class="route-list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    <hr>
                    <div class="create-route-form">
                    <input type="text" class="new-route-title" placeholder="ìƒˆ ë£¨íŠ¸ ì œëª©" style="width:100%; margin-bottom:.25rem;">
                    <input type="text" class="new-route-summary" placeholder="ë£¨íŠ¸ ìš”ì•½(ì„ íƒ, 200ì ì´ë‚´)" style="width:100%; margin-bottom:.25rem;">
                    <label style="display:inline-flex; align-items:center; gap:6px; cursor:pointer; font-size:14px;">
                        <input type="checkbox" class="new-route-public" checked>
                        <span>ê³µê°œ ë£¨íŠ¸ë¡œ ë§Œë“¤ê¸°</span> 
                    </label>
                    <button type="button" class="create-route-btn">ï¼‹ ìƒˆ ë£¨íŠ¸ ë§Œë“¤ê¸°</button>
                    </div>
                </div>
                {% endif %}
                </div>
                <ul class="tag-list">
                {% for tag in place.tags.all %}
                    <li class="tag">#{{ tag.name }}</li>
                {% endfor %}
                </ul>
                {% endwith %}
            </li>
            
        {% endfor %}
    </ul>



</div>
<!-- <div class="pagination">
    {% if likes_page.has_previous %}
        <a href="?page_likes={{ likes_page.previous_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">ì´ì „</a>
    {% endif %}
    <span>{{ likes_page.number }}</span> 
    <span>{{ likes_page.paginator.num_pages }}</span> 
    {% if likes_page.has_next %}
        <a href="?page_likes={{ likes_page.next_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">ë‹¤ìŒ</a>
    {% endif %}
</div> -->
{% if likes_page.paginator.num_pages > 1 %}
<div class="pagination">

  {# ì´ì „ ë²„íŠ¼ #}
  {% if likes_page.has_previous %}
    <a href="?page_likes={{ likes_page.previous_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">ì´ì „</a>
  {% endif %}

  {# ì²« í˜ì´ì§€ + ... #}
  {% if likes_page.number > 3 %}
    <a href="?page_likes=1&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">1</a>
    {% if likes_page.number > 4 %}
      <span>â€¦</span>
    {% endif %}
  {% endif %}

  {# í˜„ì¬ í˜ì´ì§€ ì£¼ë³€ ë²ˆí˜¸ #}
  {% for num in likes_page.paginator.page_range %}
    {% if num >= likes_page.number|add:"-2" and num <= likes_page.number|add:"2" %}
      {% if num == likes_page.number %}
        <span class="current">{{ num }}</span>
      {% else %}
        <a href="?page_likes={{ num }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">{{ num }}</a>
      {% endif %}
    {% endif %}
  {% endfor %}

  {# ... + ë§ˆì§€ë§‰ í˜ì´ì§€ #}
  {% if likes_page.number < likes_page.paginator.num_pages|add:"-2" %}
    {% if likes_page.number < likes_page.paginator.num_pages|add:"-3" %}
      <span>â€¦</span>
    {% endif %}
    <a href="?page_likes={{ likes_page.paginator.num_pages }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">
      {{ likes_page.paginator.num_pages }}
    </a>
  {% endif %}

  {# ë‹¤ìŒ ë²„íŠ¼ #}
  {% if likes_page.has_next %}
    <a href="?page_likes={{ likes_page.next_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">ë‹¤ìŒ</a>
  {% endif %}

</div>
{% endif %}


{% else %}
<p>ì•„ì§ ì¢‹ì•„ìš”í•œ ì¥ì†Œê°€ ì—†ì–´ìš”.</p>
{% endif %}
