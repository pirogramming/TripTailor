{% load static %}
{% if likes_page %}
<link rel="stylesheet" href="{% static 'css/users/likes.css' %}?v={% now 'U' %}">
<div>
    <ul class="place-list">
        {% for like in likes_page %}
            
            <li class="place-item">
                {% with place=like.place %}
                <div 
                id="map-{{ place.id }}"
                class="place-item__map"
                data-lat="{{place.lat}}"
                data-lng="{{place.lng}}"
                ></div> <!-- 지도/이미지 자리 -->
                <div class="place-item__head">
                <span class="place-item__name">{{ place.name }}</span>
                <span class="place-item__meta">({{ place.region }}) ·
                    {% if place.place_class == 1 %}레포츠{% elif place.place_class == 2 %}쇼핑{% elif place.place_class == 3 %}관광지{% elif place.place_class == 4 %}문화시설{% endif %}
                </span>
                <a class="place-item__link" href="{% url 'places:place_detail' place.pk %}">자세히 보기</a>

                {% if user.is_authenticated %}
                <form method="post" action="{% url 'places:place_like' place.pk %}" class="like-form">
                    {% csrf_token %}
                    <button type="submit" class="like-button">
                    {% if place.is_liked %}❤️ 찜취소{% else %}🤍 찜하기{% endif %}
                    </button>
                </form>

                <button type="button" class="add-to-route-btn" data-place-id="{{ place.id }}">➕ 루트에 추가</button>
                <div class="route-dropdown" style="display:none; position:absolute; background:#fff; border:1px solid #ccc; padding:.5rem; z-index:10; min-width:200px;">
                    <div class="route-list">불러오는 중...</div>
                    <hr>
                    <div class="create-route-form">
                    <input type="text" class="new-route-title" placeholder="새 루트 제목" style="width:100%; margin-bottom:.25rem;">
                    <input type="text" class="new-route-summary" placeholder="루트 요약(선택, 200자 이내)" style="width:100%; margin-bottom:.25rem;">
                    <label style="display:inline-flex; align-items:center; gap:6px; cursor:pointer; font-size:14px;">
                        <input type="checkbox" class="new-route-public" checked>
                        <span>공개 루트로 만들기</span> 
                    </label>
                    <button type="button" class="create-route-btn">＋ 새 루트 만들기</button>
                    </div>
                </div>
                {% endif %}
                </div>
                <ul class="tag-list">
                {% for tag in place.tags.all %}
                    <li class="tag">#{{ tag.name }}</li>
                {% endfor %}
                </ul>
                {% endwith %}
            </li>
            
        {% endfor %}
    </ul>



</div>
<!-- <div class="pagination">
    {% if likes_page.has_previous %}
        <a href="?page_likes={{ likes_page.previous_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">이전</a>
    {% endif %}
    <span>{{ likes_page.number }}</span> 
    <span>{{ likes_page.paginator.num_pages }}</span> 
    {% if likes_page.has_next %}
        <a href="?page_likes={{ likes_page.next_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">다음</a>
    {% endif %}
</div> -->
{% if likes_page.paginator.num_pages > 1 %}
<div class="pagination">

  {# 이전 버튼 #}
  {% if likes_page.has_previous %}
    <a href="?page_likes={{ likes_page.previous_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">이전</a>
  {% endif %}

  {# 첫 페이지 + ... #}
  {% if likes_page.number > 3 %}
    <a href="?page_likes=1&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">1</a>
    {% if likes_page.number > 4 %}
      <span>…</span>
    {% endif %}
  {% endif %}

  {# 현재 페이지 주변 번호 #}
  {% for num in likes_page.paginator.page_range %}
    {% if num >= likes_page.number|add:"-2" and num <= likes_page.number|add:"2" %}
      {% if num == likes_page.number %}
        <span class="current">{{ num }}</span>
      {% else %}
        <a href="?page_likes={{ num }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">{{ num }}</a>
      {% endif %}
    {% endif %}
  {% endfor %}

  {# ... + 마지막 페이지 #}
  {% if likes_page.number < likes_page.paginator.num_pages|add:"-2" %}
    {% if likes_page.number < likes_page.paginator.num_pages|add:"-3" %}
      <span>…</span>
    {% endif %}
    <a href="?page_likes={{ likes_page.paginator.num_pages }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">
      {{ likes_page.paginator.num_pages }}
    </a>
  {% endif %}

  {# 다음 버튼 #}
  {% if likes_page.has_next %}
    <a href="?page_likes={{ likes_page.next_page_number }}&page_routes={{ routes_page.number }}&page_reviews={{ reviews_page.number }}">다음</a>
  {% endif %}

</div>
{% endif %}


{% else %}
<p>아직 좋아요한 장소가 없어요.</p>
{% endif %}
