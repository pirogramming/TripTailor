<ul class="review-list">
  {% for r in reviews %}
  <li class="review-item">
    <div class="review-header">
      <div class="review-meta">
        <span class="rating">⭐ {{ r.rating }}</span>
      </div>
      <div class="review-info">
        <span class="author">by {{ r.user.username }}</span>
        <span class="date">{{ r.created_at|date:"Y-m-d H:i" }}</span>
      </div>
    </div>

    <div class="review-content">
      {{ r.content|linebreaksbr }}
    </div>

    {# ✅ 사진 있을 때만 표시: exists() 대신 count 또는 all 사용 #}
    {% if r.photos.count %}
    <div class="review-photos">
      {% for photo in r.photos.all %}
        {# ✅ URL(과거 방식) 우선, 없으면 image.url(파일 업로드) 사용 #}
        {% with src=photo.url|default:photo.image.url %}
          {% if src %}
            <img
              src="{{ src }}"
              alt="댓글 이미지"
              class="review-photo"
              loading="lazy"
              style="max-width: 100px; max-height: 100px; margin: 5px; border-radius: 5px; object-fit: cover;">
          {% endif %}
        {% endwith %}
      {% endfor %}
    </div>
    {% endif %}

    {% if user == r.user %}
      <div class="action-buttons">
        <a href="{% url 'reviews:place_edit' place.id r.id %}" class="btn btn-sm btn-outline-primary">✏️ 수정</a>
        <button type="button" class="btn btn-sm btn-outline-danger delete-review-btn"
                data-review-id="{{ r.id }}" data-place-id="{{ place.id }}">🗑️ 삭제</button>
      </div>
    {% endif %}
  </li>
  {% empty %}
  <li class="no-reviews">등록된 댓글이 없습니다.</li>
  {% endfor %}
</ul>
