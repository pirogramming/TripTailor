{% load static %}
<link rel="stylesheet" href="{% static 'css/review_list.css' %}">

<ul class="review-list">
  {% for r in reviews %}
  <li class="review-item">
    <div class="review-header">
      <div class="review-user">
        <div class="author">{{ r.user.username }}</div>
        <span class="date">{{ r.created_at|date:"Y-m-d H:i" }}</span>        
      </div>
      <div class="review-meta">
        <span class="rating">â­ {{ r.rating }}</span>
      </div>        
    </div>

    <div class="review-content">
      {{ r.content|linebreaksbr }}
    </div>

    {# âœ… ì‚¬ì§„ ìˆì„ ë•Œë§Œ í‘œì‹œ: exists() ëŒ€ì‹  count ë˜ëŠ” all ì‚¬ìš© #}
    {% if r.photos.count %}
    <div class="review-photos">
      {% for photo in r.photos.all %}
        {# âœ… ì•ˆì „í•˜ê²Œ ì´ë¯¸ì§€ ì ‘ê·¼: image í•„ë“œê°€ ìˆê³  íŒŒì¼ì´ ìˆì„ ë•Œë§Œ ì‚¬ìš© #}
        {% if photo.image %}
          <img
            src="{{ photo.image.url }}"
            alt="ëŒ“ê¸€ ì´ë¯¸ì§€"
            class="review-photo"
            loading="lazy"
            style="max-width: 100px; max-height: 100px; margin: 5px; border-radius: 5px; object-fit: cover;">
        {% endif %}
      {% endfor %}
    </div>
        <div id="imageModal" class="modal" onclick="closeModal()">
          <span class="close">&times;</span>
          <img class="modal-content" id="modalImg">
        </div>
    {% endif %}

    {% if user == r.user %}
      <div class="action-buttons">
        <a href="{% url 'reviews:place_edit' place.id r.id %}" class="btn btn-sm btn-outline-primary">âœï¸ ìˆ˜ì •</a>
        <button type="button" class="btn btn-sm btn-outline-danger delete-review-btn"
                data-review-id="{{ r.id }}" data-place-id="{{ place.id }}">ğŸ—‘ï¸ ì‚­ì œ</button>
      </div>
    {% endif %}
  </li>
  {% empty %}
  <li class="no-reviews">ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
  {% endfor %}
</ul>

<script>
function openModal(img) {
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImg");
  modal.style.display = "block";
  modalImg.src = img.src;
}
function closeModal() {
  document.getElementById("imageModal").style.display = "none";
}
</script>