{% extends 'base.html' %}
{% block title %}ë¦¬ë·° ëª©ë¡{% endblock %}

{% block content %}
<h1>ë¦¬ë·° ëª©ë¡</h1>

<form method="get" class="mb-3">
  <input type="number" name="route" value="{{ request.GET.route }}" placeholder="route id í•„í„°">
  <input type="number" name="user" value="{{ request.GET.user }}" placeholder="user id í•„í„°">
  <button type="submit">í•„í„°</button>
  <a href="{% url 'reviews:list' %}">ì´ˆê¸°í™”</a>
</form>

{% if user.is_authenticated %}
  <p><a href="{% url 'reviews:create' %}" class="btn btn-primary">+ ë¦¬ë·° ì‘ì„±</a></p>
{% endif %}

<ul>
  {% for r in reviews %}
  <li>
    <a href="{% url 'reviews:detail' r.pk %}">{{ r.title }}</a>
    <div>[{{ r.route }}] â˜… {{ r.rating }} â€” {{ r.summary }}</div>
    <div>by {{ r.user }} Â· {{ r.created_at|date:"Y-m-d H:i" }}</div>

    {# ğŸ”¹ ì‘ì„±ìë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ #}
    {% if user.is_authenticated and user.id == r.user_id %}
      <a href="{% url 'reviews:edit' r.pk %}" class="btn btn-sm btn-outline-primary">âœï¸ ìˆ˜ì •</a>
      <form action="{% url 'reviews:delete' r.pk %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-outline-danger">ğŸ—‘ ì‚­ì œ</button>
      </form>
    {% endif %}
  </li>
  {% empty %}
  <li>ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
  {% endfor %}
</ul>

{% if is_paginated %}
  <div class="pagination">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.route %}&route={{ request.GET.route }}{% endif %}{% if request.GET.user %}&user={{ request.GET.user }}{% endif %}">&laquo; Prev</a>
    {% endif %}
    <span>{{ page_obj.number }} / {{ paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if request.GET.route %}&route={{ request.GET.route }}{% endif %}{% if request.GET.user %}&user={{ request.GET.user }}{% endif %}">Next &raquo;</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
