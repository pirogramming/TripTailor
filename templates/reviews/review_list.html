{% extends 'base.html' %}
{% block title %}리뷰 목록{% endblock %}

{% block content %}
<h1>리뷰 목록</h1>

<form method="get" class="mb-3">
  <input type="number" name="route" value="{{ request.GET.route }}" placeholder="route id 필터">
  <input type="number" name="user" value="{{ request.GET.user }}" placeholder="user id 필터">
  <button type="submit">필터</button>
  <a href="{% url 'reviews:list' %}">초기화</a>
</form>

{% if user.is_authenticated %}
  <p><a href="{% url 'reviews:create' %}" class="btn btn-primary">+ 리뷰 작성</a></p>
{% endif %}

<ul>
  {% for r in reviews %}
  <li>
    <a href="{% url 'reviews:detail' r.pk %}">{{ r.title }}</a>
    <div>[{{ r.route }}] ★ {{ r.rating }} — {{ r.summary }}</div>
    <div>by {{ r.user }} · {{ r.created_at|date:"Y-m-d H:i" }}</div>

    {# 🔹 작성자만 수정/삭제 버튼 노출 #}
    {% if user.is_authenticated and user.id == r.user_id %}
      <a href="{% url 'reviews:edit' r.pk %}" class="btn btn-sm btn-outline-primary">✏️ 수정</a>
      <form action="{% url 'reviews:delete' r.pk %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-outline-danger">🗑 삭제</button>
      </form>
    {% endif %}
  </li>
  {% empty %}
  <li>등록된 리뷰가 없습니다.</li>
  {% endfor %}
</ul>

{% if is_paginated %}
  <div class="pagination">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.route %}&route={{ request.GET.route }}{% endif %}{% if request.GET.user %}&user={{ request.GET.user }}{% endif %}">&laquo; Prev</a>
    {% endif %}
    <span>{{ page_obj.number }} / {{ paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if request.GET.route %}&route={{ request.GET.route }}{% endif %}{% if request.GET.user %}&user={{ request.GET.user }}{% endif %}">Next &raquo;</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
