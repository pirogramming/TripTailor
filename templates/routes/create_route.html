{% extends 'base.html' %}
{% load static %}

{% block content %}
<h2>ğŸ—ºï¸ ìƒˆ ë£¨íŠ¸ ë§Œë“¤ê¸°</h2>

<form id="create-route-form">
  {% csrf_token %}

  <div>
    <label>ë£¨íŠ¸ ì œëª©</label><br />
    <input type="text" name="title" required />
  </div>

  <div>
    <label>ì§€ì—­ ìš”ì•½</label><br />
    <input type="text" name="location_summary" maxlength="200" />
  </div>

  <div>
    <label>ì„¤ëª…</label><br />
    <textarea name="description"></textarea>
  </div>

  <div>
    <label>ëŒ€í‘œ ì´ë¯¸ì§€ URL</label><br />
    <input type="url" name="cover_photo_url" />
  </div>

  <div>
    <label>
      <input type="checkbox" name="is_public" value="true" checked />
      ê³µê°œ ë£¨íŠ¸ë¡œ ì„¤ì •
    </label>
  </div>

  <button type="submit">ë£¨íŠ¸ ìƒì„±</button>
</form>

<script>
  document.getElementById("create-route-form").addEventListener("submit", async function (e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);

    // ì²´í¬ ì•ˆ ë¼ ìˆìœ¼ë©´ ì•„ì˜ˆ ì•ˆ ë³´ë‚´ì§€ë‹ˆê¹Œ falseë¡œ ìˆ˜ë™ ì§€ì •
    if (!form.querySelector('input[name="is_public"]').checked) {
      formData.set("is_public", "false");
    }

    const response = await fetch("{% url 'routes:create_route' %}", {
      method: "POST",
      body: formData,
      credentials: "same-origin",
      headers: {
        "X-CSRFToken": form.querySelector('[name=csrfmiddlewaretoken]').value,
      },
    });

    const data = await response.json();
    if (data.ok) {
      alert("ë£¨íŠ¸ê°€ ìƒì„±ë˜ì—ˆì–´ìš”!");
      window.location.href = `/routes/${data.route.id}/`;  // detailë¡œ ì´ë™
    } else {
      alert("ì˜¤ë¥˜: " + data.error);
    }
  });
</script>
{% endblock %}
